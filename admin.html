<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - DD1750 Vision Assistant</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #e0e0e0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            color: #4fc3f7;
            text-align: center;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #81d4fa;
            margin-top: 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #b0bec5;
        }
        
        input[type="text"],
        input[type="password"],
        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            font-size: 1em;
        }
        
        input:focus {
            outline: none;
            border-color: #4fc3f7;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
            color: #1a1a2e;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 195, 247, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .codes-list {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .code-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .code-item:last-child {
            border-bottom: none;
        }
        
        .code-text {
            color: #66bb6a;
            font-size: 1.1em;
            cursor: pointer;
        }
        
        .code-text:hover {
            color: #81c784;
        }
        
        .code-used {
            color: #78909c;
            text-decoration: line-through;
        }
        
        .code-credits {
            color: #90a4ae;
        }
        
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .status-success {
            background: rgba(102, 187, 106, 0.1);
            border: 1px solid rgba(102, 187, 106, 0.3);
            color: #66bb6a;
        }
        
        .status-error {
            background: rgba(239, 83, 80, 0.1);
            border: 1px solid rgba(239, 83, 80, 0.3);
            color: #ef5350;
        }
        
        .row {
            display: flex;
            gap: 15px;
        }
        
        .row .form-group {
            flex: 1;
        }
        
        .back-link {
            display: inline-block;
            color: #4fc3f7;
            text-decoration: none;
            margin-bottom: 20px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .copy-hint {
            color: #78909c;
            font-size: 0.85em;
            margin-top: 10px;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .stat {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 15px;
            border-radius: 6px;
        }
        
        .stat-value {
            font-size: 1.5em;
            color: #4fc3f7;
            font-weight: bold;
        }
        
        .stat-label {
            color: #90a4ae;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Back to App</a>
        <h1>üîê Admin Panel</h1>
        
        <!-- Login -->
        <div class="card" id="loginCard">
            <h2>Admin Login</h2>
            <div class="form-group">
                <label>Admin Password</label>
                <input type="password" id="adminPassword" placeholder="Enter admin password">
            </div>
            <button class="btn-primary" onclick="login()">Login</button>
            <div id="loginStatus"></div>
        </div>
        
        <!-- Generate Codes -->
        <div class="card" id="generateCard" style="display: none;">
            <h2>Generate Access Codes</h2>
            <div class="row">
                <div class="form-group">
                    <label>Number of Codes</label>
                    <input type="number" id="numCodes" value="5" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>Credits per Code</label>
                    <input type="number" id="creditsPerCode" value="25" min="1" max="1000">
                </div>
            </div>
            <button class="btn-primary" onclick="generateCodes()">Generate Codes</button>
            
            <div id="newCodesContainer" style="display: none;">
                <div class="codes-list" id="newCodesList"></div>
                <p class="copy-hint">üí° Click a code to copy it</p>
                <button class="btn-secondary" onclick="copyAllCodes()">Copy All Codes</button>
            </div>
            <div id="generateStatus"></div>
        </div>
        
        <!-- View Codes -->
        <div class="card" id="viewCard" style="display: none;">
            <h2>All Access Codes</h2>
            <button class="btn-secondary" onclick="loadCodes()">Refresh List</button>
            
            <div id="codesStats" class="stats" style="display: none;">
                <div class="stat">
                    <div class="stat-value" id="totalCodes">0</div>
                    <div class="stat-label">Total Codes</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="unusedCodes">0</div>
                    <div class="stat-label">Unused</div>
                </div>
            </div>
            
            <div class="codes-list" id="allCodesList">
                <p style="color: #78909c;">Click "Refresh List" to load codes</p>
            </div>
        </div>
    </div>
    
    <script>
        let adminPassword = '';
        let generatedCodes = [];
        
        function login() {
            adminPassword = document.getElementById('adminPassword').value;
            
            // Test the password by trying to list codes
            fetch('/admin/list-codes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: adminPassword })
            })
            .then(r => r.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('loginStatus').innerHTML = 
                        '<div class="status status-error">' + data.error + '</div>';
                } else {
                    document.getElementById('loginCard').style.display = 'none';
                    document.getElementById('generateCard').style.display = 'block';
                    document.getElementById('viewCard').style.display = 'block';
                    loadCodes();
                }
            });
        }
        
        function generateCodes() {
            const numCodes = parseInt(document.getElementById('numCodes').value);
            const creditsPerCode = parseInt(document.getElementById('creditsPerCode').value);
            
            fetch('/admin/generate-codes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    password: adminPassword,
                    num_codes: numCodes,
                    credits: creditsPerCode
                })
            })
            .then(r => r.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('generateStatus').innerHTML = 
                        '<div class="status status-error">' + data.error + '</div>';
                } else {
                    generatedCodes = data.codes;
                    const list = document.getElementById('newCodesList');
                    list.innerHTML = data.codes.map(code => 
                        `<div class="code-item">
                            <span class="code-text" onclick="copyCode('${code}')">${code}</span>
                            <span class="code-credits">${data.credits_per_code} credits</span>
                        </div>`
                    ).join('');
                    
                    document.getElementById('newCodesContainer').style.display = 'block';
                    document.getElementById('generateStatus').innerHTML = 
                        `<div class="status status-success">‚úì Generated ${data.codes.length} codes!</div>`;
                    
                    loadCodes();
                }
            });
        }
        
        function loadCodes() {
            fetch('/admin/list-codes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: adminPassword })
            })
            .then(r => r.json())
            .then(data => {
                if (data.error) return;
                
                document.getElementById('totalCodes').textContent = data.total;
                document.getElementById('unusedCodes').textContent = data.unused;
                document.getElementById('codesStats').style.display = 'flex';
                
                const list = document.getElementById('allCodesList');
                if (data.codes.length === 0) {
                    list.innerHTML = '<p style="color: #78909c;">No codes generated yet</p>';
                } else {
                    list.innerHTML = data.codes.map(c => 
                        `<div class="code-item">
                            <span class="code-text ${c.used ? 'code-used' : ''}" 
                                  onclick="copyCode('${c.code}')">${c.code}</span>
                            <span class="code-credits">
                                ${c.credits} credits
                                ${c.used ? ' ‚Ä¢ Used' : ' ‚Ä¢ Available'}
                            </span>
                        </div>`
                    ).join('');
                }
            });
        }
        
        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                // Brief visual feedback
                event.target.style.color = '#fff';
                setTimeout(() => {
                    event.target.style.color = '';
                }, 200);
            });
        }
        
        function copyAllCodes() {
            const text = generatedCodes.join('\n');
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied ' + generatedCodes.length + ' codes to clipboard!');
            });
        }
        
        // Allow Enter key to login
        document.getElementById('adminPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });
    </script>
</body>
</html>
